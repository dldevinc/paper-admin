{% load i18n %}

<tr class="paper-formset__form {% if inline_form.form.errors %} paper-formset__form--invalid{% endif %}{% if inline_admin_formset.opts.sortable %} sortable-item{% endif %}{% if inline_form.original or inline_form.show_url %} has_original{% endif %}">
  {% for fieldset in inline_form %}
    {% for admin_field in fieldset %}
      {% with field=admin_field.field is_readonly=admin_field.is_readonly is_prepopulated=admin_field.is_prepopulated %}
        {% if not field.is_hidden %}
          <td class="{% if field.name %}field-{{ field.name }}{% endif %}">
            {% if is_readonly %}
              <div class="readonly">{{ field.contents }}</div>
            {% else %}
              <div class="position-relative">
                <div class="paper-widget{% if field.errors %} paper-widget--invalid{% endif %}{% if is_prepopulated %} prepopulated-field{% endif %}"
                     {% if is_prepopulated %}
                     data-prepopulate-field-name="{{ field.name }}"
                     {% endif %}>
                  {{ field }}
                </div>

                <ul class="paper-error-list invalid-tooltip">{% spaceless %}
                  {% for error in field.errors %}
                    <li>{{ error }}</li>
                  {% endfor %}
                {% endspaceless %}</ul>
              </div>
            {% endif %}
          </td>
        {% endif %}
      {% endwith %}
    {% endfor %}
  {% endfor %}

  <td class="tools-cell">
    {% if inline_form.needs_explicit_pk_field %}
      {{ inline_form.pk_field.field }}
    {% endif %}

    {{ inline_form.fk_field.field }}

    {% for fieldset in inline_form %}
      {% for admin_field in fieldset %}
        {% if admin_field.field.is_hidden %}
          {{ admin_field.field }}
        {% endif %}
      {% endfor %}
    {% endfor %}

    <div class="tool-items">
      {% if inline_form.show_url %}
        <a href="{{ inline_form.absolute_url }}"
           class="tool-item text-info"
           data-toggle="tooltip"
           data-placement="bottom"
           data-trigger="hover"
           data-html="true"
           title="{% trans 'View on site' %}"
           target="_blank"
           rel="noopener">
          <i class="fa fa-fw fa-eye"></i>
        </a>
      {% endif %}

      {% if inline_admin_formset.formset.can_delete and inline_admin_formset.has_delete_permission and inline_form.original %}
        <label for="{{ inline_form.deletion_field.field.id_for_label }}"
               class="delete-inline tool-item">
          {{ inline_form.deletion_field.field }}
          <span class="delete-inline-text"> {{ inline_form.deletion_field.field.label }}</span>
        </label>
      {% endif %}

      {% if not inline_form.original and not inline_form.show_url %}
        <button type="button"
                class="tool-item text-danger"
                data-formset-toggle="delete"
                data-toggle="tooltip"
                data-placement="bottom"
                data-trigger="hover"
                data-html="true"
                title="{% trans 'Delete' %}">
          <i class="fa fa-fw fa-trash"></i>
        </button>
      {% endif %}

      {% if inline_admin_formset.opts.sortable %}
        <button type="button"
                class="sortable-move-up tool-item text-info"
                data-formset-toggle="up"
                data-toggle="tooltip"
                data-placement="bottom"
                data-trigger="hover"
                data-html="true"
                title="{% trans 'Move up' %}">
          <i class="fa fa-fw fa-chevron-up"></i>
        </button>

        <button type="button"
                class="sortable-move-down tool-item text-info"
                data-formset-toggle="down"
                data-toggle="tooltip"
                data-placement="bottom"
                data-trigger="hover"
                data-html="true"
                title="{% trans 'Move down' %}">
          <i class="fa fa-fw fa-chevron-down"></i>
        </button>
      {% endif %}
    </div>
  </td>
</tr>
