{% extends "admin/base_site.html" %}
{% load i18n admin_urls admin_list %}
{% load paper_list %}

{% block styles %}
  {{ block.super }}
  {{ media.css }}
{% endblock %}

{% block scripts %}
  {{ block.super }}
  {{ media.js }}
{% endblock %}

{% block bodyclass %}{{ block.super }} app-{{ opts.app_label }} model-{{ opts.model_name }} change-list{% endblock %}


{% block header_buttons %}
  {% block object-tools %}
    <ul class="list-inline list-unstyled mb-0">
      {% block object-tools-items %}
        {% change_list_object_tools %}
      {% endblock %}
    </ul>
  {% endblock %}
{% endblock %}


{% block breadcrumb_items %}
  <li class="breadcrumb-item">
    <a href="{% url 'admin:app_list' app_label=cl.opts.app_label %}">{{ cl.opts.app_config.verbose_name }}</a>
  </li>

  <li class="breadcrumb-item active" aria-current="page">
    <span>{{ cl.opts.verbose_name_plural|capfirst }}</span>
  </li>
{% endblock breadcrumb_items %}


{% block messages %}
  {{ block.super }}

  {% for error in cl.formset.non_form_errors %}
    <li class="paper-message paper-message--error">
      {{ error }}
    </li>
  {% endfor %}
{% endblock %}


{% block content_title %}
  {% firstof cl.opts.verbose_name_plural title as page_title %}
  <h1>{{ page_title|capfirst }}</h1>
{% endblock %}


{% block toolbar %}
  {% if cl.has_filters %}
    <div class="paper-card card">
      <h3 class="card-header">{% trans 'Filters' %}</h3>
      <div class="card-body">
        {% block filters %}
          <form action="" method="get">
            {% for spec in cl.filter_specs %}
              {% paper_filter cl spec %}
            {% endfor %}

            {% get_filter_keep_params as filter_keep_params %}
            {% for name, value in filter_keep_params %}
              <input type="hidden" name="{{ name }}" value="{{ value }}">
            {% endfor %}

            <button type="submit" class="btn btn-info btn-lg btn-block">
              {% trans 'Apply' %}
            </button>

            {% if cl.has_active_filters %}
              <a href="{{ cl.clear_all_filters_qs }}" class="btn btn-block btn-danger">
                <i class="fa fa-remove"></i>
                <span>{% trans "Clear all filters" %}</span>
              </a>
            {% endif %}
          </form>
        {% endblock %}
      </div>
    </div>
  {% endif %}
{% endblock %}


{% block content %}
  {% if cl.result_count and cl.date_hierarchy %}
    <div class="paper-card card mb-3">
      <h5 class="card-header">
        {% trans 'Filter by date' %}
      </h5>
      <div class="card-body">
        {% block date_hierarchy %}
          {% date_hierarchy cl %}
        {% endblock %}
      </div>
    </div>
  {% endif %}

  {% if cl.result_count %}
    <div class="row">
      {% if action_form and actions_on_top and cl.show_admin_actions %}
        <div class="col-lg mb-3 order-1 order-lg-0">
          {% admin_actions %}
        </div>
      {% else %}
        <div class="col-lg"></div>
      {% endif %}

      <div class="col-auto mb-3">
        {% block search %}
          {% search_form cl %}
        {% endblock %}
      </div>
    </div>

    <form id="changelist-form" method="post"{% if cl.formset.is_multipart %} enctype="multipart/form-data"{% endif %} novalidate>
      {% csrf_token %}

      {% if cl.formset %}
        {{ cl.formset.management_form }}
      {% endif %}

      {% block result_list %}
        {% paper_result_list cl %}
      {% endblock %}
    </form>

    {% if cl.formset or action_form and actions_on_bottom and cl.show_admin_actions %}
      <div class="row">
        {% if action_form and actions_on_bottom and cl.show_admin_actions %}
          <div class="col-md mt-3">
            {% admin_actions %}
          </div>
        {% else %}
          <div class="col-md"></div>
        {% endif %}

        {% if cl.formset %}
          <div class="col-auto mt-3">
            <button type="submit" form="changelist-form" name="_save" class="btn btn-sm btn-success">
              <i class="fa fa-save"></i><span>{% trans 'Save' %}</span>
            </button>
          </div>
        {% else %}
          <div class="col-auto"></div>
        {% endif %}
      </div>
    {% endif %}
  {% else %}
    {% if cl.full_result_count %}
      <div class="paper-message paper-message--info">
        <h4>{% trans 'Nothing found' %}!</h4>
        <a href="?{% if cl.is_popup %}{{ POPUP_VAR }}=1{% endif %}">
          {% trans 'Reset search and filters' %}
        </a>
      </div>
    {% else %}
      <p class="paper-message paper-message--warning">
        {% blocktrans with cl.opts.verbose_name_plural|capfirst as name_plural %}{{ name_plural }} are not created yet{% endblocktrans %}.
      </p>
    {% endif %}
  {% endif %}
{% endblock %}
