{"version":3,"sources":["webpack:///./paper_admin/static/paper_admin/src/js/changelist.js","webpack:///./paper_admin/static/paper_admin/src/js/components/RelatedObjectLookups.js","webpack:///./paper_admin/static/paper_admin/src/js/components/actions.js","webpack:///./paper_admin/static/paper_admin/src/js/components/search.js","webpack:///./paper_admin/static/paper_admin/src/js/components/sortable_table/ListTree.js","webpack:///./paper_admin/static/paper_admin/src/js/components/sortable_table/SortableTable.js","webpack:///./paper_admin/static/paper_admin/src/js/components/sortable_table/StaggerHighlight.js"],"names":["window","addEventListener","event","defaultPrevented","ctrlKey","paperMain","document","getElementById","pagination","querySelector","key","click","preventDefault","whenDomReady","table","classList","contains","SortableTable","url","dataset","orderUrl","tree","handler","$","find","tooltip","title","gettext","placement","trigger","html","delay","show","hide","id_to_windowname","text","replace","windowname_to_id","showAdminPopup","triggeringLink","name_regexp","add_popup","name","id","href","indexOf","browser_left","screenX","screenLeft","browser_top","screenY","screenTop","browser_width","outerWidth","body","clientWidth","browser_height","outerHeight","clientHeight","popup_width","popup_height","top_position","Math","round","left_position","win","open","focus","showRelatedObjectLookupPopup","dismissRelatedLookupPopup","chosenId","elem","className","value","close","showRelatedObjectPopup","updateRelatedObjectLinks","$this","siblings","closest","length","val","each","elm","attr","removeAttr","dismissAddRelatedObjectPopup","newId","newRepr","elemName","nodeName","toUpperCase","options","Option","dismissChangeRelatedObjectPopup","objId","select","textContent","dismissDeleteRelatedObjectPopup","remove","showAddAnotherPopup","dismissAddAnotherPopup","ready","on","opener","data","e","Event","isDefaultPrevented","checked","jQuery","TOGGLE_ALL_ID","CHECKBOX_CLASS","CHECKBOX_LABEL_SELECTOR","COUNTER_CLASS","QUESTION_CLASS","ALL_CLASS","ACROSS_CLASS","CLEAR_CLASS","checkboxes","querySelectorAll","initActions","Array","from","inputs","lastChecked","allToggleInput","rows","map","input","toggleRows","updateCounter","target","tagName","state","Boolean","detail","checkbox","toggle","row","label_clicked","checkbox_label","shiftKey","lastIndex","targetIndex","startIndex","min","endIndex","max","input_slice","slice","selectAcross","clearAcross","protectEditForm","list_editable_changed","form","action_button","agree","confirm","save_button","action_selects","action_changed","prototype","every","call","apply","forEach","dispatchEvent","CustomEvent","bubbles","cancelable","selected","reduce","sum","counters","counter","innerHTML","interpolate","ngettext","sel","cnt","actionsIcnt","showQuestion","question","hidden","setAcrossInput","acrossInput","Number","allContainer","clear","ListTree","elements","_buildTree","_createNode","child","pk","parseInt","parent","element","childs","_addNode","node","_nodes","isNaN","_roots","push","getNode","Error","stack","stack_node","unshift","shift","bind","getRoots","root_node","getDescendants","result","child_pk","child_node","concat","opts","Object","assign","disabledClass","tbody","_createSortable","Sortable","create","animation","draggable","handle","filter","ghostClass","onStart","_onStart","onMove","_onMove","onEnd","_onEnd","evt","item_parentId","item","parentId","add","related","moved","_getMovedRows","_normalizeTable","_createOrderMap","highlighter","StaggerHighlight","_sendRequest","then","release","sliceStart","oldIndex","newIndex","sliceEnd","pk_array","order_array","order","movedDown","pop","i","setAttribute","prev","previousElementSibling","next","nextElementSibling","parents","isPrevSibling","isNextChild","Element","after","fetch","method","credentials","headers","JSON","stringify","response","ok","error","status","statusText","staggerMin","staggerMax","_elements","_isReleased","_timer","_createTimer","count","speed","setInterval","_destroyTimer","_removeClass","clearInterval"],"mappings":"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","file":"changelist.chunk.min.js","sourcesContent":["/* global gettext */\n\nimport whenDomReady from \"when-dom-ready\";\nimport SortableTable from \"./components/sortable_table/SortableTable\";\nimport \"./components/actions\";\nimport \"./components/RelatedObjectLookups\";\nimport \"./components/search\";\n\n\n// Ctrl + Arrows navigation\nwindow.addEventListener('keydown', function(event) {\n    if (event.defaultPrevented) {\n        return; // Do nothing if the event was already processed\n    }\n\n    if (event.ctrlKey) {\n        const paperMain = document.getElementById('paper-main');\n        const pagination = paperMain.querySelector('.pagination');\n        if (!pagination) {\n            return\n        }\n\n        switch (event.key) {\n            case \"Left\":\n            case \"ArrowLeft\":\n                pagination.querySelector('.page-link[aria-label=\"Previous\"]').click();\n                break;\n            case \"Right\":\n            case \"ArrowRight\":\n                pagination.querySelector('.page-link[aria-label=\"Next\"]').click();\n                break;\n            default:\n                // Quit when this doesn't handle the key event.\n                return;\n        }\n\n        // Cancel the default action to avoid it being handled twice\n        event.preventDefault();\n    }\n});\n\n\nwhenDomReady(function() {\n    const table = document.getElementById('result_list');\n    if (table && table.classList.contains('table-sortable')) {\n        if (table.classList.contains('table-sortable-allowed')) {\n            new SortableTable(table, {\n                url: table.dataset.orderUrl,\n                tree: table.classList.contains('table-mptt'),\n                handler: '.sort-handler'\n            });\n        } else {\n            $(table).find('.sort-handler').tooltip({\n                title: gettext('Sort list by this column to enable ordering'),\n                placement: 'bottom',\n                trigger: 'hover',\n                html: true,\n                delay: {\n                    show: 300,\n                    hide: 100\n                }\n            });\n        }\n    }\n});\n","// Handles related-objects functionality: lookup link for raw_id_fields\n// and Add Another links.\n\n(function($) {\n    'use strict';\n\n    // IE doesn't accept periods or dashes in the window name, but the element IDs\n    // we use to generate popup window names may contain them, therefore we map them\n    // to allowed characters in a reversible way so that we can locate the correct\n    // element when the popup window is dismissed.\n    function id_to_windowname(text) {\n        text = text.replace(/\\./g, '__dot__');\n        text = text.replace(/-/g, '__dash__');\n        return text;\n    }\n\n    function windowname_to_id(text) {\n        text = text.replace(/__dot__/g, '.');\n        text = text.replace(/__dash__/g, '-');\n        return text;\n    }\n\n    function showAdminPopup(triggeringLink, name_regexp, add_popup) {\n        let name = triggeringLink.id.replace(name_regexp, '');\n        name = id_to_windowname(name);\n        let href = triggeringLink.href;\n        if (add_popup) {\n            if (href.indexOf('?') === -1) {\n                href += '?_popup=1';\n            } else {\n                href += '&_popup=1';\n            }\n        }\n\n        // Центрирование popup\n        const browser_left = typeof window.screenX !== 'undefined' ? window.screenX : window.screenLeft,\n            browser_top = typeof window.screenY !== 'undefined' ? window.screenY : window.screenTop,\n            browser_width = typeof window.outerWidth !== 'undefined' ? window.outerWidth : document.body.clientWidth,\n            browser_height = typeof window.outerHeight !== 'undefined' ? window.outerHeight : document.body.clientHeight,\n            popup_width = 940,\n            popup_height = 600,\n            top_position = browser_top + Math.round((browser_height - popup_height) / 2),\n            left_position = browser_left + Math.round((browser_width - popup_width) / 2);\n\n        const win = window.open(href, name,\n            'width=' + popup_width +\n            ',height=' + popup_height +\n            ',top=' + top_position +\n            ',left=' + left_position +\n            ',resizable=yes,scrollbars=yes'\n        );\n\n        win.focus();\n        return false;\n    }\n\n    function showRelatedObjectLookupPopup(triggeringLink) {\n        return showAdminPopup(triggeringLink, /^lookup_/, true);\n    }\n\n    function dismissRelatedLookupPopup(win, chosenId) {\n        const name = windowname_to_id(win.name);\n        const elem = document.getElementById(name);\n        if (elem.className.indexOf('vManyToManyRawIdAdminField') !== -1 && elem.value) {\n            elem.value += ',' + chosenId;\n        } else {\n            document.getElementById(name).value = chosenId;\n        }\n        win.close();\n    }\n\n    function showRelatedObjectPopup(triggeringLink) {\n        return showAdminPopup(triggeringLink, /^(change|add|delete)_/, false);\n    }\n\n    function updateRelatedObjectLinks(triggeringLink) {\n        const $this = $(triggeringLink);\n        const siblings = $this.closest('.related-widget-wrapper').find('.view-related, .change-related, .delete-related');\n        if (!siblings.length) {\n            return;\n        }\n        const value = $this.val();\n        if (value) {\n            siblings.each(function() {\n                const elm = $(this);\n                elm.attr('href', elm.attr('data-href-template').replace('__fk__', value));\n            });\n        } else {\n            siblings.removeAttr('href');\n        }\n    }\n\n    function dismissAddRelatedObjectPopup(win, newId, newRepr) {\n        const name = windowname_to_id(win.name);\n        const elem = document.getElementById(name);\n        if (elem) {\n            const elemName = elem.nodeName.toUpperCase();\n            if (elemName === 'SELECT') {\n                elem.options[elem.options.length] = new Option(newRepr, newId, true, true);\n            } else if (elemName === 'INPUT') {\n                if (elem.className.indexOf('vManyToManyRawIdAdminField') !== -1 && elem.value) {\n                    elem.value += ',' + newId;\n                } else {\n                    elem.value = newId;\n                }\n            }\n            // Trigger a change event to update related links if required.\n            $(elem).trigger('change');\n        }\n        win.close();\n    }\n\n    function dismissChangeRelatedObjectPopup(win, objId, newRepr, newId) {\n        const id = windowname_to_id(win.name).replace(/^edit_/, '');\n        const select = $('#' + id);\n        select.find('option').each(function() {\n            if (this.value === objId) {\n                this.textContent = newRepr;\n                this.value = newId;\n            }\n        });\n        win.close();\n    }\n\n    function dismissDeleteRelatedObjectPopup(win, objId) {\n        const id = windowname_to_id(win.name).replace(/^delete_/, '');\n        const select = $('#' + id);\n        select.find('option').each(function() {\n            if (this.value === objId) {\n                $(this).remove();\n            }\n        }).trigger('change');\n        win.close();\n    }\n\n    // Global for testing purposes\n    window.id_to_windowname = id_to_windowname;\n    window.windowname_to_id = windowname_to_id;\n\n    window.showRelatedObjectLookupPopup = showRelatedObjectLookupPopup;\n    window.dismissRelatedLookupPopup = dismissRelatedLookupPopup;\n    window.showRelatedObjectPopup = showRelatedObjectPopup;\n    window.updateRelatedObjectLinks = updateRelatedObjectLinks;\n    window.dismissAddRelatedObjectPopup = dismissAddRelatedObjectPopup;\n    window.dismissChangeRelatedObjectPopup = dismissChangeRelatedObjectPopup;\n    window.dismissDeleteRelatedObjectPopup = dismissDeleteRelatedObjectPopup;\n\n    // Kept for backward compatibility\n    window.showAddAnotherPopup = showRelatedObjectPopup;\n    window.dismissAddAnotherPopup = dismissAddRelatedObjectPopup;\n\n    $(document).ready(function() {\n        $(\"a[data-popup-opener]\").on('click', function(event) {\n            event.preventDefault();\n            opener.dismissRelatedLookupPopup(window, $(this).data(\"popup-opener\"));\n        });\n        $('body').on('click', '.related-widget-wrapper-link', function(e) {\n            e.preventDefault();\n            if (this.href) {\n                const event = $.Event('django:show-related', {href: this.href});\n                $(this).trigger(event);\n                if (!event.isDefaultPrevented()) {\n                    showRelatedObjectPopup(this);\n                }\n            }\n        }).on('change', '.related-widget-wrapper select', function() {\n            const event = $.Event('django:update-related');\n            $(this).trigger(event);\n            if (!event.isDefaultPrevented()) {\n                updateRelatedObjectLinks(this);\n            }\n        }).on('change', '.related-widget-wrapper input', function() {\n            if (this.checked) {\n                updateRelatedObjectLinks(this);\n            }\n        }).on('click', '.related-lookup', function(e) {\n            e.preventDefault();\n            const event = $.Event('django:lookup-related');\n            $(this).trigger(event);\n            if (!event.isDefaultPrevented()) {\n                showRelatedObjectLookupPopup(this);\n            }\n        });\n\n        $('.related-widget-wrapper select').trigger('change');\n        $('.related-widget-wrapper input:checked').trigger('change');\n    });\n\n})(jQuery);\n","/*global gettext, interpolate, ngettext*/\n\nimport whenDomReady from \"when-dom-ready\";\n\nconst TOGGLE_ALL_ID = 'action-toggle';\nconst CHECKBOX_CLASS = 'action-select';\nconst CHECKBOX_LABEL_SELECTOR = '.action-checkbox .vCustomCheckbox';\nconst COUNTER_CLASS = 'action-counter';\nconst QUESTION_CLASS= 'action-question';\nconst ALL_CLASS = 'action-all';\nconst ACROSS_CLASS = 'select-across';\nconst CLEAR_CLASS = 'action-clear';\n\n\nwhenDomReady(function() {\n    const checkboxes = document.querySelectorAll(`.${CHECKBOX_CLASS}`);\n    if (checkboxes.length) {\n        initActions(Array.from(checkboxes));\n    }\n});\n\n\nfunction initActions(inputs) {\n    let lastChecked = null;\n    const table = document.getElementById('result_list');\n    const allToggleInput = document.getElementById(TOGGLE_ALL_ID);\n\n    // клик на чекбокс \"выбрать все\"\n    allToggleInput.addEventListener('change', function() {\n        const rows = inputs.map(input => input.closest('tr'));\n        toggleRows(rows, this.checked);\n        updateCounter(inputs);\n    });\n\n    // пользовательское событие выделения ряда таблицы\n    table.addEventListener('select', function(event) {\n        const target = event.target;\n        if ((target.tagName !== 'TR') || (target.closest('table') !== table)) {\n            return\n        }\n\n        const state = Boolean(event.detail.state);\n        const checkbox = target.querySelector(`.${CHECKBOX_CLASS}`);\n        checkbox.checked = state;\n        target.classList.toggle('selected', state);\n\n        // все ли чекбоксы выделены\n        allToggleInput.checked = inputs.find(input => !input.checked) == null;\n    });\n\n    table.addEventListener('click', function(event) {\n        const target = event.target;\n        const row = target.closest('tr');\n        const label_clicked = target.closest(CHECKBOX_LABEL_SELECTOR);\n        const checkbox_label = row && row.querySelector(CHECKBOX_LABEL_SELECTOR);\n        const checkbox = checkbox_label && checkbox_label.querySelector(`.${CHECKBOX_CLASS}`);\n\n        // клик вне строк таблицы\n        if (!row) {\n            return\n        }\n\n        // отмена выделения чекбокса при клике на <label>\n        if (label_clicked) {\n            event.preventDefault();\n        }\n\n        if (event.shiftKey && lastChecked && (lastChecked !== checkbox)) {\n            // массовое выделение (через Shift)\n            const lastIndex = inputs.indexOf(lastChecked);\n            const targetIndex = inputs.indexOf(checkbox);\n            const startIndex = Math.min(lastIndex, targetIndex);\n            const endIndex = Math.max(lastIndex, targetIndex);\n            const input_slice = inputs.slice(startIndex, endIndex + 1);\n            const rows = input_slice.map(input => input.closest('tr'));\n            toggleRows(rows, lastChecked.checked);\n        } else if (label_clicked || (event.ctrlKey && !event.shiftKey)) {\n            // клик на чекбокс или на строку через Ctrl\n            lastChecked = checkbox;\n            toggleRows([row], !checkbox.checked);\n        }\n\n        updateCounter(inputs);\n    });\n\n    // отмена выделения текста при клике с удержанным Shift\n    table.addEventListener('mousedown', function(event) {\n        const target = event.target;\n        if (event.shiftKey && ((target.tagName === 'TD') || (target.tagName === 'TH'))) {\n            event.preventDefault();\n        }\n    });\n\n    // выбор всех записей таблицы\n    document.addEventListener('click', function(event) {\n        const target = event.target;\n        if ((target.tagName === 'A') && target.closest(`.${QUESTION_CLASS}`)) {\n            event.preventDefault();\n            selectAcross();\n        }\n    });\n\n    // очистка выбора\n    document.addEventListener('click', function(event) {\n        const target = event.target;\n        if ((target.tagName === 'A') && target.closest(`.${CLEAR_CLASS}`)) {\n            event.preventDefault();\n            allToggleInput.checked = false;\n            const rows = inputs.map(input => input.closest('tr'));\n            toggleRows(rows, false);\n            clearAcross(inputs);\n            updateCounter(inputs);\n        }\n    });\n\n    protectEditForm();\n}\n\n/**\n * Требование подтверждения выполнения действия, если в форме были изменения.\n */\nfunction protectEditForm() {\n    let list_editable_changed = false;\n    const form = document.getElementById('changelist_form');\n\n    form.addEventListener('change', function(event) {\n        const target = event.target;\n        if (target.tagName === 'INPUT') {\n            if (target.closest(`.${CHECKBOX_CLASS}`) || (target.id === TOGGLE_ALL_ID)) {\n                // nothing\n            } else {\n                list_editable_changed = true;\n            }\n        } else if (target.tagName === 'SELECT') {\n            if (target.closest(`.action-action`)) {\n                // nothing\n            } else {\n                list_editable_changed = true;\n            }\n        } else {\n            list_editable_changed = true;\n        }\n    });\n\n    form.addEventListener('click', function(event) {\n        const target = event.target;\n        const action_button = target.closest('[name=\"index\"]');\n        if (action_button && list_editable_changed) {\n            const agree = confirm(gettext(\"You have unsaved changes on individual editable fields. If you run an action, your unsaved changes will be lost.\"));\n            if (!agree) {\n                event.preventDefault();\n            }\n        }\n    });\n\n    form.addEventListener('click', function(event) {\n        const target = event.target;\n        const save_button = target.closest('[name=\"_save\"]');\n\n        const action_selects = document.querySelectorAll('.actions select[name=\"action\"]');\n        const action_changed = !Array.prototype.every.call(action_selects, function(select) {\n            return !select.value\n        });\n        \n        if (save_button && action_changed) {\n            let apply;\n            if (list_editable_changed) {\n                apply = confirm(gettext(\"You have selected an action, but you haven't saved your changes to individual fields yet. Please click OK to save. You'll need to re-run the action.\"));\n            } else {\n                apply = confirm(gettext(\"You have selected an action, and you haven't made any changes on individual fields. You're probably looking for the Go button rather than the Save button.\"));\n            }\n            if (!apply) {\n                event.preventDefault();\n            }\n        }\n    });\n}\n\n/**\n * Установка/сброс галочки в чекбоксах.\n * @param {HTMLTableRowElement[]} rows\n * @param {Boolean} checked\n */\nfunction toggleRows(rows, checked) {\n    rows.forEach(function(row) {\n        if (row && row.tagName === 'TR') {\n            row.dispatchEvent(new CustomEvent('select', {\n                bubbles: true,\n                cancelable: true,\n                detail: {\n                    state: checked\n                }\n            }));\n        }\n    });\n}\n\nfunction updateCounter(inputs) {\n    const selected = inputs.reduce((sum, input) => sum + (input.checked ? 1 : 0), 0);\n    const counters = document.querySelectorAll(`.${COUNTER_CLASS}`);\n    counters.forEach(function(counter) {\n        counter.innerHTML = interpolate(\n            ngettext('%(sel)s of %(cnt)s selected', '%(sel)s of %(cnt)s selected', selected),\n            {\n                sel: selected,\n                cnt: counter.dataset.actionsIcnt\n            },\n            true\n        );\n    });\n\n    if (selected === inputs.length) {\n        showQuestion();\n    } else {\n        clearAcross(inputs);\n    }\n}\n\n/**\n * Показ ссылки \"выбрать всё\"\n */\nfunction showQuestion() {\n    const question = document.querySelector(`.${QUESTION_CLASS}`);\n    question && (question.hidden = false);\n}\n\n/**\n * Установка значения input-элементу для выполнения действия над всеми элементами\n * @param {Boolean} value\n */\nfunction setAcrossInput(value) {\n    const acrossInput = document.querySelectorAll(`.${ACROSS_CLASS}`);\n    acrossInput.forEach(function(input) {\n        input.value = Number(value);\n    });\n}\n\nfunction selectAcross() {\n    setAcrossInput(true);\n\n    const counter = document.querySelector(`.${COUNTER_CLASS}`);\n    counter && (counter.hidden = true);\n\n    const allContainer = document.querySelector(`.${ALL_CLASS}`);\n    allContainer && (allContainer.hidden = false);\n\n    const question = document.querySelector(`.${QUESTION_CLASS}`);\n    question && (question.hidden = true);\n\n    const clear = document.querySelector(`.${CLEAR_CLASS}`);\n    clear && (clear.hidden = false);\n}\n\nfunction clearAcross(inputs) {\n    setAcrossInput(false);\n\n    const counter = document.querySelector(`.${COUNTER_CLASS}`);\n    counter && (counter.hidden = false);\n\n    const allContainer = document.querySelector(`.${ALL_CLASS}`);\n    allContainer && (allContainer.hidden = true);\n\n    const selected = inputs.reduce((sum, input) => sum + (input.checked ? 1 : 0), 0);\n    const question = document.querySelector(`.${QUESTION_CLASS}`);\n    question && (question.hidden = selected !== inputs.length);\n\n    const clear = document.querySelector(`.${CLEAR_CLASS}`);\n    clear && (clear.hidden = true);\n}\n","import whenDomReady from \"when-dom-ready\";\n\n\nwhenDomReady(function() {\n    const form = document.querySelector('.paper-search-form');\n    const input = form && form.querySelector('.form-control');\n    input && input.addEventListener('focus', function() {\n        this.select();\n    });\n});\n","/**\n * Представление списка DOM-элементов в виде дерева.\n * Каждый DOM-элемент должен иметь data-атрибуты: id, parent.\n * Каждый дочерний узел должен идти после родителя.\n * @module ListTree\n */\n\n/**\n * @typedef {Object} module:ListTree.ListTreeNode\n * @property {Number}       pk\n * @property {Number}       parent\n * @property {HTMLElement}  element\n * @property {Number[]}     childs\n */\n\n/**\n * Конструктор объектов ListTree.\n * @param {NodeList|Element[]} elements\n * @constructor\n */\nfunction ListTree(elements) {\n    this._buildTree(elements);\n}\n\n/**\n * Создание узла дерева.\n * @param {HTMLElement} child\n * @returns {module:ListTree.ListTreeNode}\n * @private\n */\nListTree.prototype._createNode = function(child) {\n    const dataset = child.dataset;\n    return {\n        pk: parseInt(dataset.id),\n        parent: parseInt(dataset.parent),\n        element: child,\n        childs: []\n    };\n};\n\n/**\n * Добавление узла дерева в карту, для быстрого поиска по ID.\n * @param {module:ListTree.ListTreeNode} node\n * @returns {Boolean}\n * @private\n */\nListTree.prototype._addNode = function(node) {\n    if (node && (typeof node.pk === 'number')) {\n        this._nodes[node.pk] = node;\n        if (isNaN(node.parent)) {\n            this._roots.push(node);\n        }\n        return true;\n    }\n    return false;\n};\n\n/**\n * Получение узла по ID.\n * @param {Number} pk\n * @returns {module:ListTree.ListTreeNode}\n */\nListTree.prototype.getNode = function(pk) {\n    if (this._nodes === null) {\n        throw new Error('tree is empty');\n    }\n    if (!(pk in this._nodes)) {\n        throw new Error(`node ${pk} not found`);\n    }\n    return this._nodes[pk];\n};\n\n/**\n * Построение дерева из элементов.\n * @param {Element[]} elements\n * @private\n */\nListTree.prototype._buildTree = function(elements) {\n    const stack = [];\n\n    this._nodes = {};\n    this._roots = [];\n    elements.forEach(function(elem) {\n        let node = this._createNode(elem);\n        this._addNode(node);\n\n        while (stack.length) {\n            let stack_node = stack[0];\n            if (node.parent === stack_node.pk) {\n                stack_node.childs.push(node.pk);\n                stack.unshift(node);\n                return\n            }\n            stack.shift();\n        }\n\n        stack.unshift(node);\n    }.bind(this));\n};\n\n/**\n * Получение корневых элементов.\n * @returns {Element[]}\n */\nListTree.prototype.getRoots = function() {\n    if (this._roots === null) {\n        throw new Error('tree is empty');\n    }\n    return this._roots.map(function(root_node) {\n        return root_node.element\n    }.bind(this));\n};\n\n/**\n * Получение всех потомков узла.\n * @param {Number} pk\n * @returns {Element[]}\n */\nListTree.prototype.getDescendants = function(pk) {\n    const node = this.getNode(pk);\n    return node.childs.reduce(function(result, child_pk) {\n        let child_node = this.getNode(child_pk);\n        if (child_node) {\n            result.push(child_node.element);\n            result = result.concat(this.getDescendants(child_pk));\n        }\n        return result\n    }.bind(this), []);\n};\n\n\nexport default ListTree;\n","/**\n * Таблица с возможностью сортировки строк.\n * Каждая строка должна иметь атрибут data-id.\n * В случае, если строки представляют дерево, то еще необходим атрибут data-parent.\n * @module SortableTable\n */\n\n/**\n * @typedef {Object} module:SortableTable.SortableTableOptions\n * @property {String}  url\n * @property {Boolean} [tree]\n * @property {String}  [handler]\n * @property {String}  [disabledClass]\n */\n\nimport Sortable from \"sortablejs\";\nimport ListTree from \"./ListTree\";\nimport StaggerHighlight from \"./StaggerHighlight\";\n\n/**\n * Конструктор объектов SortableTable.\n * @param {Element} table\n * @param {module:SortableTable.SortableTableOptions} [options]\n * @constructor\n */\nfunction SortableTable(table, options) {\n    /** @type {module:SortableTable.SortableTableOptions} */\n    this.opts = Object.assign({\n        url: null,\n        tree: false,\n        handler: '.handler',\n        disabledClass: 'disabled'\n    }, options);\n\n    /** @type {Element} */\n    this.table = table;\n\n    /** @type {Element} */\n    this.tbody = table.querySelector('tbody');\n    if (!this.tbody) {\n        throw new Error('table body not found');\n    }\n\n    /** @type {?ListTree} */\n    this.tree = null;\n\n    this._createSortable();\n}\n\n/**\n * Инициализация плагина сортировки.\n * @private\n */\nSortableTable.prototype._createSortable = function() {\n    return Sortable.create(this.tbody, {\n        animation: 0,\n        draggable: 'tr',\n        handle: this.opts.handler,\n        filter: '.' + this.opts.disabledClass,\n        ghostClass: 'sortable-ghost',\n        onStart: this._onStart.bind(this),\n        onMove: this._onMove.bind(this),\n        onEnd: this._onEnd.bind(this),\n    });\n};\n\n/**\n * Обработчик события начала перетаскивания.\n * @param evt\n * @private\n */\nSortableTable.prototype._onStart = function(evt) {\n    const rows = this.tbody.querySelectorAll('tr');\n\n    if (this.opts.tree) {\n        this.tree = new ListTree(rows);\n    }\n\n    // блокируем все узлы, кроме соседних\n    const item_parentId = parseInt(evt.item.dataset.parent);\n    rows.forEach(function(row) {\n        const parentId = parseInt(row.dataset.parent);\n        if ((!isNaN(parentId) || !isNaN(item_parentId)) && parentId !== item_parentId) {\n            row.classList.add(this.opts.disabledClass);\n        }\n    }.bind(this));\n};\n\n/**\n * Обработчик события перетаскивания.\n * @param evt\n * @returns {Boolean}\n * @private\n */\nSortableTable.prototype._onMove = function(evt) {\n    return !evt.related.classList.contains(this.opts.disabledClass);\n};\n\n/**\n * Обработчик события завершения перетаскивания.\n * @param evt\n * @private\n */\nSortableTable.prototype._onEnd = function(evt) {\n    // снимаем блокировку со всех узлов\n    const rows = this.tbody.querySelectorAll('tr');\n    rows.forEach(function(row) {\n        row.classList.remove(this.opts.disabledClass);\n    }.bind(this));\n\n    let moved = this._getMovedRows(evt);\n    if (!moved.length) {\n        return\n    }\n\n    this._normalizeTable(evt, moved);\n\n    const map = this._createOrderMap(evt, moved);\n\n    // выделение рядов, учавствовавших в перемещении\n    const highlighter = new StaggerHighlight(moved);\n    this._sendRequest(map).then(function() {\n        highlighter.release();\n    });\n};\n\n/**\n * Получение строк, чей порядок изменился.\n * @param evt\n * @returns {Element[]}\n * @private\n */\nSortableTable.prototype._getMovedRows = function(evt) {\n    const sliceStart = Math.min(evt.oldIndex, evt.newIndex);\n    const sliceEnd = Math.max(evt.oldIndex, evt.newIndex);\n    const rows = this.tbody.querySelectorAll('tr');\n    let slice = Array.prototype.slice.call(rows, sliceStart, sliceEnd + 1);\n    if (this.tree) {\n        // пропускаем узлы, не являющиеся соседними\n        const pk = parseInt(evt.item.dataset.id);\n        const node = this.tree.getNode(pk);\n        slice = slice.filter(function(row) {\n            return parseInt(row.dataset.parent) === node.parent\n        });\n    }\n    return slice;\n};\n\n/**\n * Создание карты новых значений сортировки строк.\n * @param evt\n * @param {Element[]} rows\n * @returns {Object}\n * @private\n */\nSortableTable.prototype._createOrderMap = function(evt, rows) {\n    const pk_array = [];\n    const order_array = [];\n    rows.forEach(function(row) {\n        const handle = row.querySelector(this.opts.handler);\n        if (handle) {\n            pk_array.push(parseInt(row.dataset.id));\n            order_array.push(parseInt(handle.dataset.order));\n        }\n    }.bind(this));\n\n    // циклический сдвиг значений order\n    const movedDown = evt.oldIndex < evt.newIndex;\n    if (movedDown) {\n        order_array.unshift(order_array.pop());\n    } else {\n        order_array.push(order_array.shift());\n    }\n\n    return pk_array.reduce(function(result, pk, i) {\n        result[pk] = order_array[i];\n\n        // обновляем атрибут order\n        const row = this.tbody.querySelector('tr[data-id=\"'+pk+'\"]');\n        row.querySelector(this.opts.handler).setAttribute('data-order', order_array[i]);\n\n        return result;\n    }.bind(this), {});\n};\n\n/**\n * Нормализация таблицы.\n * Все дочерние строки перемещаются под своего родителя.\n * Без этого метода может случиться ситуация, когда элемент\n * был перемещен между своим соседом и его детьми.\n * @param evt\n * @param {Element[]} moved\n * @private\n */\nSortableTable.prototype._normalizeTable = function(evt, moved) {\n    if (this.tree) {\n        const pk = parseInt(evt.item.dataset.id);\n        const node = this.tree.getNode(pk);\n        const prev = evt.item.previousElementSibling;\n        const next = evt.item.nextElementSibling;\n        const parents = moved.slice();\n        if (prev && next) {\n            // если предыдущая строка - сосед, а следующая - ребенок соседа,\n            // то сосед должен быть в списке нормализации.\n            const isPrevSibling = parseInt(prev.dataset.parent) === node.parent;\n            const isNextChild = parseInt(next.dataset.parent) === parseInt(prev.dataset.id);\n            if (isPrevSibling && isNextChild && (parents.indexOf(prev) < 0)) {\n                parents.unshift(prev);\n            }\n        }\n\n        // перенос детей под родителя\n        parents.forEach(function(parent) {\n            const pk = parseInt(parent.dataset.id);\n            const childs = this.tree.getDescendants(pk);\n            Element.prototype.after.apply(parent, childs);\n        }.bind(this));\n    }\n};\n\n/**\n * Отправка новых значений сортировки на сервер.\n * @param {Object} data\n * @returns {Promise<Response>}\n * @private\n */\nSortableTable.prototype._sendRequest = function(data) {\n    return fetch(this.opts.url, {\n        method: 'POST',\n        credentials: 'same-origin',\n        headers: {\n            'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(data)\n    }).then(function(response) {\n        if (!response.ok) {\n            const error = new Error(`${response.status} ${response.statusText}`);\n            error.response = response;\n            throw error;\n        }\n    });\n};\n\n\nexport default SortableTable;\n","/**\n * Прелоадер для списков / таблиц.\n * Последовательно добавляет класс DOM-элементам и удаляет этот класс,\n * когда выполняется последнее событие из:\n * a) всем элементам был добавлен класс\n * b) вызван метод release()\n * @module StaggerHighlight\n */\n\n/**\n * @typedef {Object} module:StaggerHighlight.StaggerHighlightOptions\n * @property {String} className\n * @property {Number} staggerMin\n * @property {Number} staggerMax\n */\n\n/**\n * Конструктор объектов StaggerHighlight.\n * @param {Element[]} elements\n * @param {module:StaggerHighlight.StaggerHighlightOptions} [options]\n * @constructor\n */\nfunction StaggerHighlight(elements, options) {\n    /** @type module:StaggerHighlight.StaggerHighlightOptions */\n    this.opts = Object.assign({\n        className: 'highlight',\n        staggerMin: 12,\n        staggerMax: 50\n    }, options);\n\n    /**\n     * @type {Element[]}\n     * @private\n     */\n    this._elements = elements;\n\n    /**\n     * @type {Boolean}\n     * @private\n     */\n    this._isReleased = false;\n\n    /**\n     * @type {?Number}\n     * @private\n     */\n    this._timer = this._createTimer();\n}\n\n/**\n * Создание таймера, выделяюего элементы один за другим.\n * @returns {Number}\n * @private\n */\nStaggerHighlight.prototype._createTimer = function() {\n    let i = 0;\n    const count = this._elements.length;\n    const speed = Math.max(this.opts.staggerMin, this.staggerMax * 2 / count);\n    return setInterval(function() {\n        if (i < count) {\n            this._elements[i].classList.add(this.opts.className);\n            i++;\n        } else {\n            this._destroyTimer();\n            if (this._isReleased) {\n                this._removeClass();\n            }\n        }\n    }.bind(this), speed);\n};\n\n/**\n * Уничтожение таймера.\n * @private\n */\nStaggerHighlight.prototype._destroyTimer = function() {\n    if (this._timer !== null) {\n        clearInterval(this._timer);\n        this._timer = null;\n    }\n};\n\n/**\n * Немедленное удаление класса со всех элементов.\n * @private\n */\nStaggerHighlight.prototype._removeClass = function() {\n    this._elements.forEach(function(node) {\n        node.classList.remove(this.opts.className);\n    }.bind(this));\n};\n\n/**\n * Сигнал завершения операции.\n */\nStaggerHighlight.prototype.release = function() {\n    this._isReleased = true;\n    if (this._timer === null) {\n        this._removeClass();\n    }\n};\n\n\nexport default StaggerHighlight;\n"],"sourceRoot":""}