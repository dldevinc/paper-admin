{"version":3,"sources":["webpack:///./paper_admin/static/paper_admin/src/js/components/sortable_table/ListTree.js","webpack:///./paper_admin/static/paper_admin/src/js/components/sortable_table/StaggerHighlight.js","webpack:///./paper_admin/static/paper_admin/src/js/components/sortable_table/SortableTable.js","webpack:///./paper_admin/static/paper_admin/src/js/changelist.js","webpack:///./paper_admin/static/paper_admin/src/js/components/RelatedObjectLookups.js","webpack:///./paper_admin/static/paper_admin/src/js/components/actions.js"],"names":["ListTree","elements","this","_buildTree","prototype","_createNode","child","dataset","pk","parseInt","id","parent","element","childs","_addNode","node","_nodes","isNaN","_roots","push","getNode","Error","stack","forEach","elem","length","stack_node","unshift","shift","bind","getRoots","map","root_node","getDescendants","reduce","result","child_pk","child_node","concat","StaggerHighlight","options","opts","Object","assign","className","staggerMin","staggerMax","_elements","_isReleased","_timer","_createTimer","i","count","speed","Math","max","setInterval","classList","add","_destroyTimer","_removeClass","clearInterval","remove","release","SortableTable","table","url","tree","handler","disabledClass","tbody","querySelector","_createSortable","Sortable","create","animation","draggable","handle","filter","ghostClass","onStart","_onStart","onMove","_onMove","onEnd","_onEnd","evt","rows","querySelectorAll","item_parentId","item","row","parentId","related","contains","moved","_getMovedRows","_normalizeTable","_createOrderMap","highlighter","_sendRequest","then","sliceStart","min","oldIndex","newIndex","sliceEnd","slice","Array","call","pk_array","order_array","order","pop","setAttribute","prev","previousElementSibling","next","nextElementSibling","parents","isPrevSibling","isNextChild","indexOf","Element","after","apply","data","fetch","method","credentials","headers","body","JSON","stringify","response","ok","error","status","statusText","catch","text","bootbox","alert","message","size","window","addEventListener","event","defaultPrevented","ctrlKey","pagination","document","getElementById","key","click","preventDefault","whenDomReady","orderUrl","$","find","tooltip","title","gettext","placement","trigger","html","delay","show","hide","id_to_windowname","replace","windowname_to_id","showAdminPopup","triggeringLink","name_regexp","add_popup","name","href","browser_left","screenX","screenLeft","browser_top","screenY","screenTop","browser_width","outerWidth","clientWidth","browser_height","outerHeight","clientHeight","top_position","round","left_position","open","focus","showRelatedObjectLookupPopup","showRelatedObjectPopup","updateRelatedObjectLinks","$this","siblings","closest","value","val","each","elm","attr","removeAttr","dismissAddRelatedObjectPopup","win","newId","newRepr","elemName","nodeName","toUpperCase","Option","close","dismissRelatedLookupPopup","chosenId","dismissChangeRelatedObjectPopup","objId","textContent","dismissDeleteRelatedObjectPopup","showAddAnotherPopup","dismissAddAnotherPopup","ready","on","opener","e","Event","isDefaultPrevented","checked","jQuery","TOGGLE_ALL_ID","CHECKBOX_CLASS","COUNTER_CLASS","QUESTION_CLASS","ALL_CLASS","ACROSS_CLASS","CLEAR_CLASS","toggleInputs","inputs","input","Boolean","dispatchEvent","bubbles","cancelable","updateCounter","selected","sum","counter","innerHTML","interpolate","ngettext","sel","cnt","actionsIcnt","question","hidden","showQuestion","clearAcross","setAcrossInput","Number","allContainer","clear","checkboxes","lastChecked","allToggleInput","target","toggle","target_state","checkbox","shiftKey","lastIndex","targetIndex","startIndex","endIndex","tagName","selectAcross","list_editable_changed","form","confirm","save_button","action_selects","action_changed","every","select","protectEditForm","initActions","from"],"mappings":"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","file":"changelist.chunk.min.js","sourcesContent":["/**\n * Представление списка DOM-элементов в виде дерева.\n * Каждый DOM-элемент должен иметь data-атрибуты: id, parent.\n * Каждый дочерний узел должен идти после родителя.\n * @module ListTree\n */\n\n/**\n * @typedef {Object} module:ListTree.ListTreeNode\n * @property {Number}       pk\n * @property {Number}       parent\n * @property {HTMLElement}  element\n * @property {Number[]}     childs\n */\n\n/**\n * Конструктор объектов ListTree.\n * @param {NodeList|Element[]} elements\n * @constructor\n */\nfunction ListTree(elements) {\n    this._buildTree(elements);\n}\n\n/**\n * Создание узла дерева.\n * @param {HTMLElement} child\n * @returns {module:ListTree.ListTreeNode}\n * @private\n */\nListTree.prototype._createNode = function(child) {\n    const dataset = child.dataset;\n    return {\n        pk: parseInt(dataset.id),\n        parent: parseInt(dataset.parent),\n        element: child,\n        childs: []\n    };\n};\n\n/**\n * Добавление узла дерева в карту, для быстрого поиска по ID.\n * @param {module:ListTree.ListTreeNode} node\n * @returns {Boolean}\n * @private\n */\nListTree.prototype._addNode = function(node) {\n    if (node && (typeof node.pk === 'number')) {\n        this._nodes[node.pk] = node;\n        if (isNaN(node.parent)) {\n            this._roots.push(node);\n        }\n        return true;\n    }\n    return false;\n};\n\n/**\n * Получение узла по ID.\n * @param {Number} pk\n * @returns {module:ListTree.ListTreeNode}\n */\nListTree.prototype.getNode = function(pk) {\n    if (this._nodes === null) {\n        throw new Error('tree is empty');\n    }\n    if (!(pk in this._nodes)) {\n        throw new Error(`node ${pk} not found`);\n    }\n    return this._nodes[pk];\n};\n\n/**\n * Построение дерева из элементов.\n * @param {Element[]} elements\n * @private\n */\nListTree.prototype._buildTree = function(elements) {\n    const stack = [];\n\n    this._nodes = {};\n    this._roots = [];\n    elements.forEach(function(elem) {\n        let node = this._createNode(elem);\n        this._addNode(node);\n\n        while (stack.length) {\n            let stack_node = stack[0];\n            if (node.parent === stack_node.pk) {\n                stack_node.childs.push(node.pk);\n                stack.unshift(node);\n                return\n            }\n            stack.shift();\n        }\n\n        stack.unshift(node);\n    }.bind(this));\n};\n\n/**\n * Получение корневых элементов.\n * @returns {Element[]}\n */\nListTree.prototype.getRoots = function() {\n    if (this._roots === null) {\n        throw new Error('tree is empty');\n    }\n    return this._roots.map(function(root_node) {\n        return root_node.element\n    }.bind(this));\n};\n\n/**\n * Получение всех потомков узла.\n * @param {Number} pk\n * @returns {Element[]}\n */\nListTree.prototype.getDescendants = function(pk) {\n    const node = this.getNode(pk);\n    return node.childs.reduce(function(result, child_pk) {\n        let child_node = this.getNode(child_pk);\n        if (child_node) {\n            result.push(child_node.element);\n            result = result.concat(this.getDescendants(child_pk));\n        }\n        return result\n    }.bind(this), []);\n};\n\n\nexport default ListTree;\n","/**\n * Прелоадер для списков / таблиц.\n * Последовательно добавляет класс DOM-элементам и удаляет этот класс,\n * когда выполняется последнее событие из:\n * a) всем элементам был добавлен класс\n * b) вызван метод release()\n * @module StaggerHighlight\n */\n\n/**\n * @typedef {Object} module:StaggerHighlight.StaggerHighlightOptions\n * @property {String} className\n * @property {Number} staggerMin\n * @property {Number} staggerMax\n */\n\n/**\n * Конструктор объектов StaggerHighlight.\n * @param {Element[]} elements\n * @param {module:StaggerHighlight.StaggerHighlightOptions} [options]\n * @constructor\n */\nfunction StaggerHighlight(elements, options) {\n    /** @type module:StaggerHighlight.StaggerHighlightOptions */\n    this.opts = Object.assign({\n        className: 'highlight',\n        staggerMin: 12,\n        staggerMax: 50\n    }, options);\n\n    /**\n     * @type {Element[]}\n     * @private\n     */\n    this._elements = elements;\n\n    /**\n     * @type {Boolean}\n     * @private\n     */\n    this._isReleased = false;\n\n    /**\n     * @type {?Number}\n     * @private\n     */\n    this._timer = this._createTimer();\n}\n\n/**\n * Создание таймера, выделяюего элементы один за другим.\n * @returns {Number}\n * @private\n */\nStaggerHighlight.prototype._createTimer = function() {\n    let i = 0;\n    const count = this._elements.length;\n    const speed = Math.max(this.opts.staggerMin, this.staggerMax * 2 / count);\n    return setInterval(function() {\n        if (i < count) {\n            this._elements[i].classList.add(this.opts.className);\n            i++;\n        } else {\n            this._destroyTimer();\n            if (this._isReleased) {\n                this._removeClass();\n            }\n        }\n    }.bind(this), speed);\n};\n\n/**\n * Уничтожение таймера.\n * @private\n */\nStaggerHighlight.prototype._destroyTimer = function() {\n    if (this._timer !== null) {\n        clearInterval(this._timer);\n        this._timer = null;\n    }\n};\n\n/**\n * Немедленное удаление класса со всех элементов.\n * @private\n */\nStaggerHighlight.prototype._removeClass = function() {\n    this._elements.forEach(function(node) {\n        node.classList.remove(this.opts.className);\n    }.bind(this));\n};\n\n/**\n * Сигнал завершения операции.\n */\nStaggerHighlight.prototype.release = function() {\n    this._isReleased = true;\n    if (this._timer === null) {\n        this._removeClass();\n    }\n};\n\n\nexport default StaggerHighlight;\n","/**\n * Таблица с возможностью сортировки строк.\n * Каждая строка должна иметь атрибут data-id.\n * В случае, если строки представляют дерево, то еще необходим атрибут data-parent.\n * @module SortableTable\n */\n\n/**\n * @typedef {Object} module:SortableTable.SortableTableOptions\n * @property {String}  url\n * @property {Boolean} [tree]\n * @property {String}  [handler]\n * @property {String}  [disabledClass]\n */\n\nimport Sortable from \"sortablejs\";\nimport bootbox from \"../../vendor/bootbox\";\nimport ListTree from \"./ListTree\";\nimport StaggerHighlight from \"./StaggerHighlight\";\n\n/**\n * Конструктор объектов SortableTable.\n * @param {Element} table\n * @param {module:SortableTable.SortableTableOptions} [options]\n * @constructor\n */\nfunction SortableTable(table, options) {\n    /** @type {module:SortableTable.SortableTableOptions} */\n    this.opts = Object.assign({\n        url: null,\n        tree: false,\n        handler: '.handler',\n        disabledClass: 'disabled'\n    }, options);\n\n    /** @type {Element} */\n    this.table = table;\n\n    /** @type {Element} */\n    this.tbody = table.querySelector('tbody');\n    if (!this.tbody) {\n        throw new Error('table body not found');\n    }\n\n    /** @type {?ListTree} */\n    this.tree = null;\n\n    this._createSortable();\n}\n\n/**\n * Инициализация плагина сортировки.\n * @private\n */\nSortableTable.prototype._createSortable = function() {\n    return Sortable.create(this.tbody, {\n        animation: 0,\n        draggable: 'tr',\n        handle: this.opts.handler,\n        filter: '.' + this.opts.disabledClass,\n        ghostClass: 'sortable-ghost',\n        onStart: this._onStart.bind(this),\n        onMove: this._onMove.bind(this),\n        onEnd: this._onEnd.bind(this),\n    });\n};\n\n/**\n * Обработчик события начала перетаскивания.\n * @param evt\n * @private\n */\nSortableTable.prototype._onStart = function(evt) {\n    const rows = this.tbody.querySelectorAll('tr');\n\n    if (this.opts.tree) {\n        this.tree = new ListTree(rows);\n    }\n\n    // блокируем все узлы, кроме соседних\n    const item_parentId = parseInt(evt.item.dataset.parent);\n    rows.forEach(function(row) {\n        const parentId = parseInt(row.dataset.parent);\n        if ((!isNaN(parentId) || !isNaN(item_parentId)) && parentId !== item_parentId) {\n            row.classList.add(this.opts.disabledClass);\n        }\n    }.bind(this));\n};\n\n/**\n * Обработчик события перетаскивания.\n * @param evt\n * @returns {Boolean}\n * @private\n */\nSortableTable.prototype._onMove = function(evt) {\n    return !evt.related.classList.contains(this.opts.disabledClass);\n};\n\n/**\n * Обработчик события завершения перетаскивания.\n * @param evt\n * @private\n */\nSortableTable.prototype._onEnd = function(evt) {\n    // снимаем блокировку со всех узлов\n    const rows = this.tbody.querySelectorAll('tr');\n    rows.forEach(function(row) {\n        row.classList.remove(this.opts.disabledClass);\n    }.bind(this));\n\n    let moved = this._getMovedRows(evt);\n    if (!moved.length) {\n        return\n    }\n\n    this._normalizeTable(evt, moved);\n\n    const map = this._createOrderMap(evt, moved);\n\n    // выделение рядов, учавствовавших в перемещении\n    const highlighter = new StaggerHighlight(moved);\n    this._sendRequest(map).then(function() {\n        highlighter.release();\n    });\n};\n\n/**\n * Получение строк, чей порядок изменился.\n * @param evt\n * @returns {Element[]}\n * @private\n */\nSortableTable.prototype._getMovedRows = function(evt) {\n    const sliceStart = Math.min(evt.oldIndex, evt.newIndex);\n    const sliceEnd = Math.max(evt.oldIndex, evt.newIndex);\n    const rows = this.tbody.querySelectorAll('tr');\n    let slice = Array.prototype.slice.call(rows, sliceStart, sliceEnd + 1);\n    if (this.tree) {\n        // пропускаем узлы, не являющиеся соседними\n        const pk = parseInt(evt.item.dataset.id);\n        const node = this.tree.getNode(pk);\n        slice = slice.filter(function(row) {\n            return parseInt(row.dataset.parent) === node.parent\n        });\n    }\n    return slice;\n};\n\n/**\n * Создание карты новых значений сортировки строк.\n * @param evt\n * @param {Element[]} rows\n * @returns {Object}\n * @private\n */\nSortableTable.prototype._createOrderMap = function(evt, rows) {\n    const pk_array = [];\n    const order_array = [];\n    rows.forEach(function(row) {\n        const handle = row.querySelector(this.opts.handler);\n        if (handle) {\n            pk_array.push(parseInt(row.dataset.id));\n            order_array.push(parseInt(handle.dataset.order));\n        }\n    }.bind(this));\n\n    // циклический сдвиг значений order\n    const movedDown = evt.oldIndex < evt.newIndex;\n    if (movedDown) {\n        order_array.unshift(order_array.pop());\n    } else {\n        order_array.push(order_array.shift());\n    }\n\n    return pk_array.reduce(function(result, pk, i) {\n        result[pk] = order_array[i];\n\n        // обновляем атрибут order\n        const row = this.tbody.querySelector('tr[data-id=\"'+pk+'\"]');\n        row.querySelector(this.opts.handler).setAttribute('data-order', order_array[i]);\n\n        return result;\n    }.bind(this), {});\n};\n\n/**\n * Нормализация таблицы.\n * Все дочерние строки перемещаются под своего родителя.\n * Без этого метода может случиться ситуация, когда элемент\n * был перемещен между своим соседом и его детьми.\n * @param evt\n * @param {Element[]} moved\n * @private\n */\nSortableTable.prototype._normalizeTable = function(evt, moved) {\n    if (this.tree) {\n        const pk = parseInt(evt.item.dataset.id);\n        const node = this.tree.getNode(pk);\n        const prev = evt.item.previousElementSibling;\n        const next = evt.item.nextElementSibling;\n        const parents = moved.slice();\n        if (prev && next) {\n            // если предыдущая строка - сосед, а следующая - ребенок соседа,\n            // то сосед должен быть в списке нормализации.\n            const isPrevSibling = parseInt(prev.dataset.parent) === node.parent;\n            const isNextChild = parseInt(next.dataset.parent) === parseInt(prev.dataset.id);\n            if (isPrevSibling && isNextChild && (parents.indexOf(prev) < 0)) {\n                parents.unshift(prev);\n            }\n        }\n\n        // перенос детей под родителя\n        parents.forEach(function(parent) {\n            const pk = parseInt(parent.dataset.id);\n            const childs = this.tree.getDescendants(pk);\n            Element.prototype.after.apply(parent, childs);\n        }.bind(this));\n    }\n};\n\n/**\n * Отправка новых значений сортировки на сервер.\n * @param {Object} data\n * @returns {Promise<Response>}\n * @private\n */\nSortableTable.prototype._sendRequest = function(data) {\n    return fetch(this.opts.url, {\n        method: 'POST',\n        credentials: 'same-origin',\n        headers: {\n            'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(data)\n    }).then(function(response) {\n        if (!response.ok) {\n            const error = new Error(`${response.status} ${response.statusText}`);\n            error.response = response;\n            throw error;\n        }\n    }).catch(function(error) {\n        error.response.text().then(function(text) {\n            bootbox.alert({\n                message: text,\n                size: 'small'\n            });\n        });\n    });\n};\n\n\nexport default SortableTable;\n","/* global gettext */\n\nimport whenDomReady from \"when-dom-ready\";\nimport SortableTable from \"./components/sortable_table/SortableTable\";\nimport \"./components/actions\";\nimport \"./components/RelatedObjectLookups\";\n\n\n// Ctrl + Arrows navigation\nwindow.addEventListener('keydown', function(event) {\n    if (event.defaultPrevented) {\n        return; // Do nothing if the event was already processed\n    }\n\n    if (event.ctrlKey) {\n        const paperMain = document.getElementById('paper-main');\n        const pagination = paperMain.querySelector('.pagination');\n        if (!pagination) {\n            return\n        }\n\n        switch (event.key) {\n            case \"Left\":\n            case \"ArrowLeft\":\n                pagination.querySelector('.page-link[aria-label=\"Previous\"]').click();\n                break;\n            case \"Right\":\n            case \"ArrowRight\":\n                pagination.querySelector('.page-link[aria-label=\"Next\"]').click();\n                break;\n            default:\n                // Quit when this doesn't handle the key event.\n                return;\n        }\n\n        // Cancel the default action to avoid it being handled twice\n        event.preventDefault();\n    }\n});\n\n\nwhenDomReady(function() {\n    const table = document.getElementById('result_list');\n    if (table && table.classList.contains('table-sortable')) {\n        if (table.classList.contains('table-sortable-allowed')) {\n            new SortableTable(table, {\n                url: table.dataset.orderUrl,\n                tree: table.classList.contains('table-mptt'),\n                handler: '.sort-handler'\n            });\n        } else {\n            $(table).find('.sort-handler').tooltip({\n                title: gettext('Sort list by this column to enable ordering'),\n                placement: 'bottom',\n                trigger: 'hover',\n                html: true,\n                delay: {\n                    show: 300,\n                    hide: 100\n                }\n            });\n        }\n    }\n});\n","// Handles related-objects functionality: lookup link for raw_id_fields\n// and Add Another links.\n\n(function($) {\n    'use strict';\n\n    // IE doesn't accept periods or dashes in the window name, but the element IDs\n    // we use to generate popup window names may contain them, therefore we map them\n    // to allowed characters in a reversible way so that we can locate the correct\n    // element when the popup window is dismissed.\n    function id_to_windowname(text) {\n        text = text.replace(/\\./g, '__dot__');\n        text = text.replace(/-/g, '__dash__');\n        return text;\n    }\n\n    function windowname_to_id(text) {\n        text = text.replace(/__dot__/g, '.');\n        text = text.replace(/__dash__/g, '-');\n        return text;\n    }\n\n    function showAdminPopup(triggeringLink, name_regexp, add_popup) {\n        let name = triggeringLink.id.replace(name_regexp, '');\n        name = id_to_windowname(name);\n        let href = triggeringLink.href;\n        if (add_popup) {\n            if (href.indexOf('?') === -1) {\n                href += '?_popup=1';\n            } else {\n                href += '&_popup=1';\n            }\n        }\n\n        // Центрирование popup\n        const browser_left = typeof window.screenX !== 'undefined' ? window.screenX : window.screenLeft,\n            browser_top = typeof window.screenY !== 'undefined' ? window.screenY : window.screenTop,\n            browser_width = typeof window.outerWidth !== 'undefined' ? window.outerWidth : document.body.clientWidth,\n            browser_height = typeof window.outerHeight !== 'undefined' ? window.outerHeight : document.body.clientHeight,\n            popup_width = 940,\n            popup_height = 600,\n            top_position = browser_top + Math.round((browser_height - popup_height) / 2),\n            left_position = browser_left + Math.round((browser_width - popup_width) / 2);\n\n        const win = window.open(href, name,\n            'width=' + popup_width +\n            ',height=' + popup_height +\n            ',top=' + top_position +\n            ',left=' + left_position +\n            ',resizable=yes,scrollbars=yes'\n        );\n\n        win.focus();\n        return false;\n    }\n\n    function showRelatedObjectLookupPopup(triggeringLink) {\n        return showAdminPopup(triggeringLink, /^lookup_/, true);\n    }\n\n    function dismissRelatedLookupPopup(win, chosenId) {\n        const name = windowname_to_id(win.name);\n        const elem = document.getElementById(name);\n        if (elem.className.indexOf('vManyToManyRawIdAdminField') !== -1 && elem.value) {\n            elem.value += ',' + chosenId;\n        } else {\n            document.getElementById(name).value = chosenId;\n        }\n        win.close();\n    }\n\n    function showRelatedObjectPopup(triggeringLink) {\n        return showAdminPopup(triggeringLink, /^(change|add|delete)_/, false);\n    }\n\n    function updateRelatedObjectLinks(triggeringLink) {\n        const $this = $(triggeringLink);\n        const siblings = $this.closest('.related-widget-wrapper').find('.view-related, .change-related, .delete-related');\n        if (!siblings.length) {\n            return;\n        }\n        const value = $this.val();\n        if (value) {\n            siblings.each(function() {\n                const elm = $(this);\n                elm.attr('href', elm.attr('data-href-template').replace('__fk__', value));\n            });\n        } else {\n            siblings.removeAttr('href');\n        }\n    }\n\n    function dismissAddRelatedObjectPopup(win, newId, newRepr) {\n        const name = windowname_to_id(win.name);\n        const elem = document.getElementById(name);\n        if (elem) {\n            const elemName = elem.nodeName.toUpperCase();\n            if (elemName === 'SELECT') {\n                elem.options[elem.options.length] = new Option(newRepr, newId, true, true);\n            } else if (elemName === 'INPUT') {\n                if (elem.className.indexOf('vManyToManyRawIdAdminField') !== -1 && elem.value) {\n                    elem.value += ',' + newId;\n                } else {\n                    elem.value = newId;\n                }\n            }\n            // Trigger a change event to update related links if required.\n            $(elem).trigger('change');\n        }\n        win.close();\n    }\n\n    function dismissChangeRelatedObjectPopup(win, objId, newRepr, newId) {\n        const id = windowname_to_id(win.name).replace(/^edit_/, '');\n        const select = $('#' + id);\n        select.find('option').each(function() {\n            if (this.value === objId) {\n                this.textContent = newRepr;\n                this.value = newId;\n            }\n        });\n        win.close();\n    }\n\n    function dismissDeleteRelatedObjectPopup(win, objId) {\n        const id = windowname_to_id(win.name).replace(/^delete_/, '');\n        const select = $('#' + id);\n        select.find('option').each(function() {\n            if (this.value === objId) {\n                $(this).remove();\n            }\n        }).trigger('change');\n        win.close();\n    }\n\n    // Global for testing purposes\n    window.id_to_windowname = id_to_windowname;\n    window.windowname_to_id = windowname_to_id;\n\n    window.showRelatedObjectLookupPopup = showRelatedObjectLookupPopup;\n    window.dismissRelatedLookupPopup = dismissRelatedLookupPopup;\n    window.showRelatedObjectPopup = showRelatedObjectPopup;\n    window.updateRelatedObjectLinks = updateRelatedObjectLinks;\n    window.dismissAddRelatedObjectPopup = dismissAddRelatedObjectPopup;\n    window.dismissChangeRelatedObjectPopup = dismissChangeRelatedObjectPopup;\n    window.dismissDeleteRelatedObjectPopup = dismissDeleteRelatedObjectPopup;\n\n    // Kept for backward compatibility\n    window.showAddAnotherPopup = showRelatedObjectPopup;\n    window.dismissAddAnotherPopup = dismissAddRelatedObjectPopup;\n\n    $(document).ready(function() {\n        $(\"a[data-popup-opener]\").on('click', function(event) {\n            event.preventDefault();\n            opener.dismissRelatedLookupPopup(window, $(this).data(\"popup-opener\"));\n        });\n        $('body').on('click', '.related-widget-wrapper-link', function(e) {\n            e.preventDefault();\n            if (this.href) {\n                const event = $.Event('django:show-related', {href: this.href});\n                $(this).trigger(event);\n                if (!event.isDefaultPrevented()) {\n                    showRelatedObjectPopup(this);\n                }\n            }\n        }).on('change', '.related-widget-wrapper select', function() {\n            const event = $.Event('django:update-related');\n            $(this).trigger(event);\n            if (!event.isDefaultPrevented()) {\n                updateRelatedObjectLinks(this);\n            }\n        }).on('change', '.related-widget-wrapper input', function() {\n            if (this.checked) {\n                updateRelatedObjectLinks(this);\n            }\n        }).on('click', '.related-lookup', function(e) {\n            e.preventDefault();\n            const event = $.Event('django:lookup-related');\n            $(this).trigger(event);\n            if (!event.isDefaultPrevented()) {\n                showRelatedObjectLookupPopup(this);\n            }\n        });\n\n        $('.related-widget-wrapper select').trigger('change');\n        $('.related-widget-wrapper input:checked').trigger('change');\n    });\n\n})(jQuery);\n","/*global gettext, interpolate, ngettext*/\n\nimport whenDomReady from \"when-dom-ready\";\n\nconst TOGGLE_ALL_ID = 'action-toggle';\nconst CHECKBOX_CLASS = 'action-select';\nconst COUNTER_CLASS = 'action-counter';\nconst QUESTION_CLASS= 'action-question';\nconst ALL_CLASS = 'action-all';\nconst ACROSS_CLASS = 'select-across';\nconst CLEAR_CLASS = 'action-clear';\n\n\nwhenDomReady(function() {\n    const checkboxes = document.querySelectorAll(`.${CHECKBOX_CLASS}`);\n    if (checkboxes.length) {\n        initActions(Array.from(checkboxes));\n    }\n});\n\n\nfunction initActions(inputs) {\n    let lastChecked = null;\n    const table = document.getElementById('result_list');\n    const allToggleInput = document.getElementById(TOGGLE_ALL_ID);\n\n    // клик на чекбокс \"выбрать все\"\n    allToggleInput.addEventListener('click', function() {\n        toggleInputs(inputs, this.checked);\n        updateCounter(inputs);\n    });\n\n    // изменение состояния чекбокса\n    table.addEventListener('change', function(event) {\n        const target = event.target;\n        if (target.classList.contains(CHECKBOX_CLASS)) {\n            const row = target.closest('tr');\n            row && row.classList.toggle('selected', target.checked);\n        }\n\n        // все ли чекбоксы выделены\n        allToggleInput.checked = inputs.find(input => !input.checked) == null;\n    });\n\n    table.addEventListener('click', function(event) {\n        // получаем чекбокс\n        let target_state;\n        let checkbox = event.target.closest(`.${CHECKBOX_CLASS}`);\n        if (!checkbox) {\n            // если клик на сам элемент, то выделение работает только в случае,\n            // когда была зажата клавиша Ctrl (или Shift для массового выделения)\n            if (!event.ctrlKey && !event.shiftKey) {\n                return\n            }\n\n            checkbox = event.target.closest('tr').querySelector(`.${CHECKBOX_CLASS}`);\n            if (!checkbox) {\n                return\n            }\n            target_state = !checkbox.checked;\n        } else {\n            // при клике на чекбокс целевое состяние уже достигнуто\n            target_state = checkbox.checked;\n        }\n\n        if (lastChecked && event.shiftKey && (lastChecked !== checkbox)) {\n            // массовое выделение (через Shift)\n            const lastIndex = inputs.indexOf(lastChecked);\n            const targetIndex = inputs.indexOf(checkbox);\n            const startIndex = Math.min(lastIndex, targetIndex);\n            const endIndex = Math.max(lastIndex, targetIndex);\n            const input_slice = inputs.slice(startIndex, endIndex + 1);\n            toggleInputs(input_slice, target_state);\n        } else if (event.target !== checkbox) {\n            // если клик на ячейку - выделяем чекбокс вручную\n            toggleInputs([checkbox], target_state);\n        }\n\n        lastChecked = checkbox;\n        updateCounter(inputs);\n    });\n\n    // отмена выделения текста при клике с удержанным Shift\n    table.addEventListener('mousedown', function(event) {\n        const target = event.target;\n        if (event.shiftKey && ((target.tagName === 'TD') || (target.tagName === 'TH'))) {\n            event.preventDefault();\n        }\n    });\n\n    // выбор всех записей таблицы\n    document.addEventListener('click', function(event) {\n        const target = event.target;\n        if ((target.tagName === 'A') && target.closest(`.${QUESTION_CLASS}`)) {\n            event.preventDefault();\n            selectAcross();\n        }\n    });\n\n    // очистка выбора\n    document.addEventListener('click', function(event) {\n        const target = event.target;\n        if ((target.tagName === 'A') && target.closest(`.${CLEAR_CLASS}`)) {\n            event.preventDefault();\n            allToggleInput.checked = false;\n            toggleInputs(inputs, false);\n            clearAcross(inputs);\n            updateCounter(inputs);\n        }\n    });\n\n    protectEditForm();\n}\n\n/**\n * Требование подтверждения выполнения дествия, если в форме были изменения.\n */\nfunction protectEditForm() {\n    let list_editable_changed = false;\n    const form = document.getElementById('changelist_form');\n\n    form.addEventListener('change', function(event) {\n        const target = event.target;\n        if ((target.tagName === 'INPUT') && !target.closest(`.${CHECKBOX_CLASS}`)) {\n            list_editable_changed = true;\n        }\n    });\n\n    form.addEventListener('click', function(event) {\n        const target = event.target;\n        const action_button = target.closest('[name=\"index\"]');\n        if (action_button && list_editable_changed) {\n            const agree = confirm(gettext(\"You have unsaved changes on individual editable fields. If you run an action, your unsaved changes will be lost.\"));\n            if (!agree) {\n                event.preventDefault();\n            }\n        }\n    });\n\n    form.addEventListener('click', function(event) {\n        const target = event.target;\n        const save_button = target.closest('[name=\"_save\"]');\n\n        const action_selects = document.querySelectorAll('.actions select[name=\"action\"]');\n        const action_changed = !Array.prototype.every.call(action_selects, function(select) {\n            return !select.value\n        });\n        \n        if (save_button && action_changed) {\n            let apply;\n            if (list_editable_changed) {\n                apply = confirm(gettext(\"You have selected an action, but you haven't saved your changes to individual fields yet. Please click OK to save. You'll need to re-run the action.\"));\n            } else {\n                apply = confirm(gettext(\"You have selected an action, and you haven't made any changes on individual fields. You're probably looking for the Go button rather than the Save button.\"));\n            }\n            if (!apply) {\n                event.preventDefault();\n            }\n        }\n    });\n}\n\n/**\n * Установка/сброс галочки в чекбоксах.\n * @param {HTMLInputElement[]} inputs\n * @param {Boolean} checked\n */\nfunction toggleInputs(inputs, checked) {\n    inputs.forEach(function(input) {\n        input.checked = Boolean(checked);\n        input.dispatchEvent(new Event('change', {\n            bubbles: true,\n            cancelable: true\n        }));\n    });\n}\n\nfunction updateCounter(inputs) {\n    const selected = inputs.reduce((sum, input) => sum + (input.checked ? 1 : 0), 0);\n    const counters = document.querySelectorAll(`.${COUNTER_CLASS}`);\n    counters.forEach(function(counter) {\n        counter.innerHTML = interpolate(\n            ngettext('%(sel)s of %(cnt)s selected', '%(sel)s of %(cnt)s selected', selected),\n            {\n                sel: selected,\n                cnt: counter.dataset.actionsIcnt\n            },\n            true\n        );\n    });\n\n    if (selected === inputs.length) {\n        showQuestion();\n    } else {\n        clearAcross(inputs);\n    }\n}\n\n/**\n * Показ ссылки \"выбрать всё\"\n */\nfunction showQuestion() {\n    const question = document.querySelector(`.${QUESTION_CLASS}`);\n    question && (question.hidden = false);\n}\n\n/**\n * Установка значения input-элементу для выполнения действия над всеми элементами\n * @param {Boolean} value\n */\nfunction setAcrossInput(value) {\n    const acrossInput = document.querySelectorAll(`.${ACROSS_CLASS}`);\n    acrossInput.forEach(function(input) {\n        input.value = Number(value);\n    });\n}\n\nfunction selectAcross() {\n    setAcrossInput(true);\n\n    const counter = document.querySelector(`.${COUNTER_CLASS}`);\n    counter && (counter.hidden = true);\n\n    const allContainer = document.querySelector(`.${ALL_CLASS}`);\n    allContainer && (allContainer.hidden = false);\n\n    const question = document.querySelector(`.${QUESTION_CLASS}`);\n    question && (question.hidden = true);\n\n    const clear = document.querySelector(`.${CLEAR_CLASS}`);\n    clear && (clear.hidden = false);\n}\n\nfunction clearAcross(inputs) {\n    setAcrossInput(false);\n\n    const counter = document.querySelector(`.${COUNTER_CLASS}`);\n    counter && (counter.hidden = false);\n\n    const allContainer = document.querySelector(`.${ALL_CLASS}`);\n    allContainer && (allContainer.hidden = true);\n\n    const selected = inputs.reduce((sum, input) => sum + (input.checked ? 1 : 0), 0);\n    const question = document.querySelector(`.${QUESTION_CLASS}`);\n    question && (question.hidden = selected !== inputs.length);\n\n    const clear = document.querySelector(`.${CLEAR_CLASS}`);\n    clear && (clear.hidden = true);\n}\n"],"sourceRoot":""}